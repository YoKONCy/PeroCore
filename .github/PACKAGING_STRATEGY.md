# PeroCore èµ„æºä¸å¤–éƒ¨åº“æ‰“åŒ…ç­–ç•¥åŠæ„å»ºæŒ‡å—

**æ—¥æœŸ**ï¼š2026-01-11  
**ç‰ˆæœ¬**ï¼š1.1 (æ•´åˆç‰ˆ)

---

## ğŸ“¦ èµ„æºæ‰“åŒ…é…ç½®

### å½“å‰é…ç½® (`tauri.conf.json`)

```json
"bundle": {
  "resources": [
    "src-tauri/python/**/*",    // Python åµŒå…¥å¼è¿è¡Œæ—¶ + æ‰€æœ‰ä¾èµ–
    "../backend/**/*"            // å®Œæ•´åç«¯ä»£ç  + é™æ€èµ„æº
  ]
}
```

---

## âœ… é™æ€èµ„æºæ‰“åŒ…æƒ…å†µ

### 1ï¸âƒ£ **æç¤ºè¯ .md æ–‡ä»¶** - âœ… **å·²æ‰“åŒ…**

**ä½ç½®**ï¼š`backend/prompts/`  
**å®é™…æ–‡ä»¶**ï¼š
- `scorer_prompt.md` (2.9 KB)

**æ‰“åŒ…è·¯å¾„**ï¼š
```
èµ„æºé…ç½®: "../backend/**/*"
  â†“
åŒ…å«: backend/prompts/scorer_prompt.md
  â†“
æ‰“åŒ…åˆ°: resources/backend/prompts/scorer_prompt.md
```

**éªŒè¯æ–¹æ³•**ï¼š
å®‰è£… MSI åæ£€æŸ¥ï¼š
```powershell
dir "C:\Program Files\PeroCore\resources\backend\prompts\"
```

---

### 2ï¸âƒ£ **å…¶ä»–é™æ€èµ„æº** - âœ… **å·²æ‰“åŒ…**

æ ¹æ® `backend/` ç›®å½•ç»“æ„ï¼Œä»¥ä¸‹æ‰€æœ‰å†…å®¹éƒ½ä¼šè¢«æ‰“åŒ…ï¼š

| ç›®å½•/æ–‡ä»¶ | å†…å®¹ | è¯´æ˜ |
|-----------|------|------|
| `backend/core/**` | æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ | âœ… æ‰“åŒ… |
| `backend/services/**` | 46+ ä¸ªæœåŠ¡æ¨¡å— | âœ… æ‰“åŒ… |
| `backend/models/**` | 7 ä¸ªæ¨¡å‹å®šä¹‰ | âœ… æ‰“åŒ… |
| `backend/prompts/**` | æç¤ºè¯æ¨¡æ¿ | âœ… æ‰“åŒ… |
| `backend/nit_core/**` | NIT æ™ºèƒ½å·¥å…·ç³»ç»Ÿ | âœ… æ‰“åŒ… |
| `backend/utils/**` | å·¥å…·å‡½æ•° | âœ… æ‰“åŒ… |
| `backend/main.py` | åç«¯å…¥å£æ–‡ä»¶ | âœ… æ‰“åŒ… |
| `backend/config.json` | é…ç½®æ–‡ä»¶ | âœ… æ‰“åŒ… |
| `backend/requirements.txt` | ä¾èµ–æ¸…å•ï¼ˆä»…ä½œå‚è€ƒï¼Œå®é™…ä¾èµ–å·²å®‰è£…åˆ° Pythonï¼‰ | âœ… æ‰“åŒ… |

**æ³¨æ„**ï¼šä»¥ä¸‹ç›®å½•**ä¸ä¼š**æ‰“åŒ…ï¼ˆä¸å½±å“è¿è¡Œï¼‰ï¼š
- `backend/venv/` - å¼€å‘ç¯å¢ƒè™šæ‹Ÿç¯å¢ƒï¼ˆç”Ÿäº§ç”¨åµŒå…¥å¼ Pythonï¼‰
- `backend/__pycache__/` - ç¼–è¯‘ç¼“å­˜ï¼ˆä¼šåœ¨è¿è¡Œæ—¶é‡æ–°ç”Ÿæˆï¼‰
- `backend/data/` - è¿è¡Œæ—¶æ•°æ®ï¼ˆåº”ç”±ç”¨æˆ·ç”Ÿæˆï¼‰
- `backend/temp_*` - ä¸´æ—¶æ–‡ä»¶å¤¹

---

## ğŸ”Œ å¤–éƒ¨åº“æ‰“åŒ…ç­–ç•¥

### ç­–ç•¥æ¦‚è¿°

PeroCore é‡‡ç”¨ **"æŒ‰éœ€ä¸‹è½½ + ç”¨æˆ·è‡ªå®šä¹‰"** çš„æ··åˆç­–ç•¥ï¼š

| ä¾èµ–ç±»å‹ | æ‰“åŒ…ç­–ç•¥ | åŸå›  |
|----------|----------|------|
| **Python è¿è¡Œæ—¶** | âœ… é¢„æ‰“åŒ… | æ ¸å¿ƒä¾èµ–ï¼Œå¿…é¡»å†…ç½® |
| **Python ç¬¬ä¸‰æ–¹åº“** | âœ… é¢„æ‰“åŒ… | é¿å…é¦–æ¬¡å¯åŠ¨æ…¢ï¼Œç½‘ç»œä¾èµ– |
| **NapCat (QQ åè®®)** | ğŸ”½ é¦–æ¬¡å¯åŠ¨ä¸‹è½½ | ä½“ç§¯å¤§ (~50MB)ï¼Œéå¼ºåˆ¶åŠŸèƒ½ |
| **Everything æœç´¢** | ğŸ”½ é¦–æ¬¡å¯åŠ¨ä¸‹è½½ | å°å·¥å…· (~600KB)ï¼ŒæŒ‰éœ€ä½¿ç”¨ |
| **Node.js** | âš ï¸ å¯é€‰æ‰“åŒ…/ä¸‹è½½ | ä»… NapCat éœ€è¦ |

---

## ğŸ“¥ NapCat æ‰“åŒ…ç­–ç•¥è¯¦è§£

### 1ï¸âƒ£ **ç­–ç•¥ï¼šé¦–æ¬¡å¯åŠ¨è‡ªåŠ¨ä¸‹è½½**

**å®ç°ä½ç½®**ï¼š`PeroLauncher/src/napcat.rs`

**ä¸‹è½½è§¦å‘æ¡ä»¶**ï¼š
```rust
// æ£€æŸ¥æ˜¯å¦å·²å®‰è£…
pub fn check_napcat_installed() -> bool {
    let dir = get_napcat_dir();  
    // backend/nit_core/plugins/social_adapter/NapCat
    
    let exe = dir.join("NapCat.Shell.exe");
    let mjs = dir.join("napcat.mjs");
    exe.exists() || mjs.exists()
}
```

**ä¸‹è½½æ—¶æœº**ï¼š
- ç”¨æˆ·åœ¨ Dashboard ä¸­ç‚¹å‡»"å®‰è£… NapCat"æŒ‰é’®
- ORï¼šåç«¯æœåŠ¡å°è¯•å¯åŠ¨ NapCat æ—¶æ£€æµ‹ä¸å­˜åœ¨

**ä¸‹è½½æº**ï¼š
```rust
// ä¸»æºï¼ˆGitHub Releaseï¼‰
let url = "https://github.com/NapNeko/NapCatQQ/releases/download/v4.10.10/NapCat.Shell.Windows.Node.zip";

// å¤‡ç”¨é•œåƒï¼ˆå›½å†…åŠ é€Ÿï¼‰
let mirror = "https://mirror.ghproxy.com/https://github.com/...";
```

**å®‰è£…ä½ç½®**ï¼š
```
backend/nit_core/plugins/social_adapter/NapCat/
  â”œâ”€â”€ NapCat.Shell.exe        (ä¸»æ‰§è¡Œæ–‡ä»¶)
  â”œâ”€â”€ napcat.mjs              (Node.js æ¨¡å¼)
  â”œâ”€â”€ index.js                (æ—§ç‰ˆå…¥å£)
  â”œâ”€â”€ node_modules/           (ä¾èµ–)
  â””â”€â”€ config/                 (é…ç½®æ–‡ä»¶)
```

**ä¸ºä»€ä¹ˆä¸é¢„æ‰“åŒ…**ï¼š
1. **ä½“ç§¯é—®é¢˜**ï¼šNapCat + Node.js â‰ˆ 50-80 MBï¼Œä¼šæ˜¾è‘—å¢åŠ å®‰è£…åŒ…å¤§å°
2. **éå¿…éœ€åŠŸèƒ½**ï¼šç¤¾äº¤è¿æ¥åŠŸèƒ½å¯é€‰ï¼Œä¸æ˜¯æ¯ä¸ªç”¨æˆ·éƒ½éœ€è¦
3. **æ›´æ–°é¢‘ç¹**ï¼šNapCat ç‰ˆæœ¬è¿­ä»£å¿«ï¼ŒæŒ‰éœ€ä¸‹è½½å¯çµæ´»æ›´æ–°
4. **è®¸å¯è¯éš”ç¦»**ï¼šç¬¬ä¸‰æ–¹ä¾èµ–ç‹¬ç«‹ä¸‹è½½ï¼Œé¿å…æ½œåœ¨è®¸å¯é—®é¢˜

---

## ğŸ” Everything æœç´¢å·¥å…·ç­–ç•¥

### ç­–ç•¥ï¼šé¦–æ¬¡ä½¿ç”¨ä¸‹è½½

**å®ç°ä½ç½®**ï¼š`PeroLauncher/src/everything.rs`

**ä¸‹è½½æº**ï¼š
```rust
let url = "https://www.voidtools.com/ES-1.1.0.27.x64.zip";
```

**å®‰è£…ä½ç½®**ï¼š
```
backend/nit_core/tools/core/FileSearch/
  â””â”€â”€ es.exe  (ä»… 600 KB å·¦å³)
```

**è§¦å‘æ—¶æœº**ï¼š
- ç”¨æˆ·åœ¨ Dashboard ç‚¹å‡»"å®‰è£…æ–‡ä»¶æœç´¢å·¥å…·"
- ORï¼šåç«¯æœåŠ¡å°è¯•ä½¿ç”¨æ–‡ä»¶æœç´¢åŠŸèƒ½æ—¶æ£€æµ‹ç¼ºå¤±

---

## ğŸš€ æ„å»ºæŒ‡å— (BUILD GUIDE)

### 1. è‡ªåŠ¨åŒ–äº‘æ‰“åŒ… (æ¨è)

é¡¹ç›®å·²é…ç½® GitHub Actions äº‘æ‰“åŒ…å·¥ä½œæµ (`.github/workflows/release.yml`)ï¼š

**è§¦å‘æ–¹å¼**ï¼š
- æ¨é€åˆ° `tauri` åˆ†æ”¯
- æ‰‹åŠ¨è§¦å‘ (workflow_dispatch)

**è‡ªåŠ¨å®Œæˆçš„å·¥ä½œ**ï¼š
1. âœ… å®‰è£… Node.js 20ã€Rust stableã€Python 3.10
2. âœ… ä¸‹è½½å¹¶é…ç½® Python 3.10 åµŒå…¥å¼ç‰ˆæœ¬åˆ° `PeroLauncher/src-tauri/python`
3. âœ… è‡ªåŠ¨å®‰è£… `backend/requirements.txt` æ‰€æœ‰ä¾èµ–åˆ°åµŒå…¥å¼ Python
4. âœ… æ„å»ºå‰ç«¯ (`npm run build`)
5. âœ… ä½¿ç”¨ Tauri v2 æ„å»º MSI å®‰è£…åŒ…
6. âœ… è‡ªåŠ¨å‘å¸ƒ Release åˆ° GitHub Releases

---

### 2. æœ¬åœ°æ„å»ºæŒ‡å—

#### **2.1 å‰ç½®è¦æ±‚**
- **Node.js** 20+
- **Rust** 1.77.2+ (é€šè¿‡ `rustup` å®‰è£…)
- **Python** 3.10+ (ç”¨äºå¼€å‘å’Œå®‰è£…ä¾èµ–)
- **WebView2** (Windows ç”¨æˆ·é€šå¸¸å·²é¢„è£…)

#### **2.2 æœ¬åœ°ä¸€é”®æ‰“åŒ…è„šæœ¬**
æˆ‘ä»¬æä¾›äº†æœ¬åœ°æ‰“åŒ…å·¥å…·ï¼Œä½äº `.\PeroCore\build_tools\pack.ps1`ã€‚

**ä½¿ç”¨æ–¹æ³•**ï¼š
```powershell
cd Perofamily\PeroCore\build_tools
.\pack.ps1
```

**è¯¥è„šæœ¬ä¼šè‡ªåŠ¨å®Œæˆä»¥ä¸‹å·¥ä½œ**ï¼š
- âœ… å‰ç«¯æ„å»ºï¼šè¿è¡Œ `npm run build`
- âœ… ç¯å¢ƒé…ç½®ï¼šä¸‹è½½ä¾¿æºå¼ Pythonã€å®‰è£…ä¾èµ–
- âœ… Tauri æ„å»ºï¼šè¿è¡Œ `npm run tauri build` ç”Ÿæˆå®‰è£…åŒ…

---

## ï¿½ï¸ æ•…éšœæ’é™¤ (Troubleshooting)

### 1. ç¼ºå°‘ WebView2 è¿è¡Œæ—¶
- **ç—‡çŠ¶**ï¼šåº”ç”¨å¯åŠ¨åæ— ååº”ã€‚
- **è§£å†³**ï¼šå®‰è£… MSI å®‰è£…åŒ…ï¼ˆè‡ªåŠ¨å¤„ç†ï¼‰æˆ–æ‰‹åŠ¨å®‰è£… [WebView2 Runtime](https://developer.microsoft.com/microsoft-edge/webview2/)ã€‚

### 2. Rust ç¼–è¯‘é”™è¯¯
- **è§£å†³**ï¼šé¡¹ç›®ç°ä½¿ç”¨ `tract-onnx` (çº¯ Rust)ï¼Œç¡®ä¿ `Cargo.toml` ä¸­æ²¡æœ‰ `ort` ç›¸å…³å†²çªã€‚

### 3. Python ä¾èµ–é—®é¢˜
- **å¼€å‘ç¯å¢ƒ**ï¼š
  ```powershell
  cd backend
  python -m venv venv
  .\venv\Scripts\activate
  pip install -r requirements.txt
  ```
- **æ‰“åŒ…ç¯å¢ƒ**ï¼šæ£€æŸ¥åµŒå…¥å¼ Python çš„ `site-packages` æ˜¯å¦å®Œæ•´ã€‚

### 4. è·¯å¾„é—®é¢˜
- **è§£å†³**ï¼šå°è¯•å®‰è£…åœ¨çº¯è‹±æ–‡è·¯å¾„ä¸‹ï¼Œé¿å…é ASCII å­—ç¬¦å¯¼è‡´çš„ Python è·¯å¾„è§£æé—®é¢˜ã€‚

---

## ï¿½ æŠ€æœ¯æ ˆç‰ˆæœ¬ä¿¡æ¯

| ç»„ä»¶ | ç‰ˆæœ¬ | è¯´æ˜ |
|------|------|------|
| Tauri | 2.x | æ¡Œé¢åº”ç”¨æ¡†æ¶ |
| Node.js | 20+ | å‰ç«¯æ„å»ºç¯å¢ƒ |
| Rust | 1.77.2+ | ç³»ç»Ÿè¯­è¨€ |
| Python | 3.10.11 (embed) | åç«¯è¿è¡Œæ—¶ |
| tract-onnx | 0.21+ | ONNX æ¨ç†å¼•æ“ (çº¯ Rust) |
| Vite | 7.x | å‰ç«¯æ„å»ºå·¥å…· |

---

## ğŸ¯ æ€»ç»“

- âœ… **æ ¸å¿ƒèµ„æºå…¨éƒ¨æ‰“åŒ…**ï¼šPythonã€Backend ä»£ç ã€æç¤ºè¯å…¨éƒ¨å†…ç½®åœ¨ MSI ä¸­ã€‚
- ğŸ”½ **å¤–éƒ¨å·¥å…·æŒ‰éœ€ä¸‹è½½**ï¼šNapCatã€Everything åœ¨ç”¨æˆ·é¦–æ¬¡ä½¿ç”¨æ—¶ä¸‹è½½ï¼Œå…¼é¡¾ä½“ç§¯ã€‚
- ğŸš€ **ä¸€é”®æ„å»ºæ”¯æŒ**ï¼šæ— è®ºæ˜¯ GitHub Actions è¿˜æ˜¯æœ¬åœ°è„šæœ¬ï¼Œå‡æ”¯æŒå…¨è‡ªåŠ¨åŒ–æµç¨‹ã€‚
