import{h as c,j as e,R as x}from"./codemirror-core-DIzFijqu.js";import{U as A,N as I,V as w,u as b,W as M,c as f,A as k,S as p,X as P,s as L}from"./react-dom-C0IJc3nR.js";import{b as R,a as D}from"./chunk-J7IRAF7C-CEN1ZIHJ.js";import{b as g,k as y,u as Q,a as B}from"./index-DiFbo-KR.js";import{M as T,a as F,b as K,c as _,d as q}from"./index-DZDDEAAG.js";import{I as U,Q as H}from"./qq_manager-CAXiLpho.js";import{u as V}from"./use-dialog-CusX8u4I.js";import{i as W}from"./chunk-MLPFQTYO-CkzEUGd_.js";import{s as X}from"./site-B19IbH4s.js";import"./iconBase-ClXMXqAg.js";import"./index-BbUFirlM.js";const G=c.createContext(null),j={didCatch:!1,error:null};class J extends c.Component{constructor(r){super(r),this.resetErrorBoundary=this.resetErrorBoundary.bind(this),this.state=j}static getDerivedStateFromError(r){return{didCatch:!0,error:r}}resetErrorBoundary(){const{error:r}=this.state;if(r!==null){for(var t,a,s=arguments.length,i=new Array(s),n=0;n<s;n++)i[n]=arguments[n];(t=(a=this.props).onReset)===null||t===void 0||t.call(a,{args:i,reason:"imperative-api"}),this.setState(j)}}componentDidCatch(r,t){var a,s;(a=(s=this.props).onError)===null||a===void 0||a.call(s,r,t)}componentDidUpdate(r,t){const{didCatch:a}=this.state,{resetKeys:s}=this.props;if(a&&t.error!==null&&Y(r.resetKeys,s)){var i,n;(i=(n=this.props).onReset)===null||i===void 0||i.call(n,{next:s,prev:r.resetKeys,reason:"keys"}),this.setState(j)}}render(){const{children:r,fallbackRender:t,FallbackComponent:a,fallback:s}=this.props,{didCatch:i,error:n}=this.state;let d=r;if(i){const u={error:n,resetErrorBoundary:this.resetErrorBoundary};if(typeof t=="function")d=t(u);else if(a)d=c.createElement(a,u);else if(s!==void 0)d=s;else throw n}return c.createElement(G.Provider,{value:{didCatch:i,error:n,resetErrorBoundary:this.resetErrorBoundary}},d)}}function Y(){let o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return o.length!==r.length||o.some((t,a)=>!Object.is(t,r[a]))}function Z({error:o,resetErrorBoundary:r}){return e.jsxs("div",{className:"pt-32 flex flex-col justify-center items-center",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(T,{className:"mr-2",color:"red",size:30}),e.jsx("h1",{className:"text-2xl",children:"出错了"})]}),e.jsxs("div",{className:"my-6 flex flex-col justify-center items-center",children:[e.jsx("p",{className:"mb-2",children:"错误信息"}),e.jsx(A,{children:o.message})]}),e.jsx(g,{color:"primary",size:"md",onPress:r,children:"重试"})]})}const O=(o,r=!1)=>o==null?void 0:o.map(t=>{var C;const a=I(),s=w(),[i,n]=x.useState(!!t.autoOpen),d=x.useMemo(()=>t.items&&t.items.length>0,[t.items]),[u]=b(y.backgroundImage,""),[m]=b(y.customIcons,{}),l=x.useMemo(()=>t.href?!!M(t.href,s.pathname):!1,[t.href,s.pathname]),h=E=>{a(E)};x.useEffect(()=>{t.items&&t.items.some(v=>(v==null?void 0:v.href)&&!!M(v.href,s.pathname))&&n(!0)},[t.items,s.pathname]);const N=x.useRef(null);return e.jsxs("div",{children:[e.jsx(g,{className:f("flex items-center w-full text-left justify-start dark:text-white transition-all duration-300",l?"bg-primary/10 text-primary dark:bg-primary/20 dark:text-primary-400 shadow-none font-semibold translate-x-1":"hover:bg-default-100 hover:translate-x-1",u&&"backdrop-blur-md text-white"),color:l?"primary":"default",endContent:d?e.jsx("div",{className:f("ml-auto relative w-3 h-3 transition-transform",i&&"transform rotate-180",l?"text-primary-500":"text-primary-200 dark:text-white","before:rounded-full",'before:content-[""]',"before:block","before:absolute","before:w-3","before:h-[4.5px]","before:bg-current","before:top-1/2","before:-left-[3px]","before:transform","before:-translate-y-1/2","before:rotate-45","after:rounded-full",'after:content-[""]',"after:block","after:absolute","after:w-3","after:h-[4.5px]","after:bg-current","after:top-1/2","after:left-[3px]","after:transform","after:-translate-y-1/2","after:-rotate-45")}):e.jsx("div",{className:f("w-3 h-1.5 rounded-full ml-auto",l?"bg-primary-500 animate-nav-spin":"bg-primary-200 dark:bg-white shadow-lg"),"aria-hidden":"true"}),startContent:m[t.label]?e.jsx(W,{radius:"none",src:m[t.label],alt:t.label,className:"w-5 h-5"}):t.icon,variant:l?r?"solid":"shadow":"light",onPress:()=>{t.href?l||h(t.href):d&&n(!i)},children:t.label}),e.jsx("div",{ref:N,className:"ml-4 overflow-hidden transition-all duration-300",style:{height:i?(C=N.current)==null?void 0:C.scrollHeight:0},children:t.items&&O(t.items,!0)})]},t.href+t.label)}),$=o=>{const{items:r}=o;return e.jsx("div",{className:"flex flex-col justify-content-center flex-1 gap-2",children:O(r)})},ee=o=>{const{open:r,items:t,onClose:a}=o,{toggleTheme:s,isDark:i}=Q(),{revokeAuth:n}=B(),d=V(),[u]=b(y.backgroundImage,""),m=!!u,l=()=>{d.confirm({title:"退出登录",content:"确定要退出登录吗？",onConfirm:n})};return e.jsxs(e.Fragment,{children:[e.jsx(k,{initial:!1,children:r&&e.jsx(p.div,{className:"fixed inset-y-0 left-64 right-0 bg-black/20 backdrop-blur-[1px] z-40 md:hidden","aria-hidden":"true",onClick:a,initial:{opacity:0},animate:{opacity:1},exit:{opacity:0,transition:{duration:.15}},transition:{duration:.2,delay:.15}})}),e.jsx(p.div,{className:f("overflow-hidden fixed top-0 left-0 h-full z-50 md:static md:shadow-none rounded-r-2xl md:rounded-none",m?"bg-transparent backdrop-blur-md":"bg-content1/70 backdrop-blur-xl backdrop-saturate-150 shadow-xl","md:bg-transparent md:backdrop-blur-none md:backdrop-saturate-100 md:shadow-none"),initial:{width:0},animate:{width:r?"16rem":0},transition:{type:r?"spring":"tween",stiffness:150,damping:r?15:10},style:{overflow:"hidden"},children:e.jsxs(p.div,{className:"w-64 flex flex-col items-stretch h-full transition-transform duration-300 ease-in-out z-30 relative float-right p-4",children:[e.jsxs("div",{className:"flex items-center justify-start gap-3 px-2 my-8 ml-2",children:[e.jsx("div",{className:"h-5 w-1 bg-primary rounded-full shadow-sm"}),e.jsx("div",{className:"text-xl font-bold text-default-900 dark:text-white tracking-wide select-none",children:"NapCat"})]}),e.jsxs("div",{className:"overflow-y-auto flex flex-col flex-1 px-2",children:[e.jsx($,{items:t}),e.jsxs("div",{className:"mt-auto mb-10 md:mb-0 space-y-3 px-2",children:[e.jsx(g,{className:"w-full bg-primary-50/50 hover:bg-primary-100/80 text-primary-600 font-medium shadow-sm hover:shadow-md transition-all duration-300 backdrop-blur-sm",radius:"full",variant:"flat",onPress:s,startContent:i?e.jsx(K,{size:18}):e.jsx(F,{size:18}),children:"切换主题"}),e.jsx(g,{className:"w-full mb-2 bg-danger-50/50 hover:bg-danger-100/80 text-danger-500 font-medium shadow-sm hover:shadow-md transition-all duration-300 backdrop-blur-sm",radius:"full",variant:"flat",onPress:l,startContent:e.jsx(U,{size:18}),children:"退出登录"})]})]})]})})]})},z=X.navItems,S=(o,r)=>{const t=[];if(r){for(const a of o)if(a.href===r)t.push(a.label);else if(a.items){const s=S(a.items,r);s.length>0&&(t.push(a.label),t.push(...s))}}return t},te=({children:o})=>{const r=w(),t=c.useRef(null),[a,s]=b(y.sideBarOpen,!0),[i]=b(y.backgroundImage,""),n=I(),{isAuth:d}=B(),u=async()=>{try{(await H.checkQQLoginStatus()).isLogin||(d?n("/qq_login",{replace:!0}):n("/web_login",{replace:!0}))}catch{n("/web_login",{replace:!0})}};c.useEffect(()=>{var l,h;(h=(l=t==null?void 0:t.current)==null?void 0:l.scrollTo)==null||h.call(l,{top:0,behavior:"smooth"})},[r.pathname]),c.useEffect(()=>{d&&u()},[d]);const m=c.useMemo(()=>S(z,r.pathname),[r.pathname]);return e.jsxs("div",{className:"h-screen relative flex items-stretch overflow-hidden",style:{backgroundImage:i?`url(${i})`:void 0,backgroundSize:"cover",backgroundPosition:"center"},children:[e.jsx(ee,{items:z,open:a,onClose:()=>s(!1)}),e.jsxs(p.div,{layout:!0,ref:t,initial:{opacity:0,scale:.98},animate:{opacity:1,scale:1},transition:{duration:.4},className:f("flex-1 overflow-y-auto","transition-all duration-300 ease-in-out","ml-0","pb-10 md:pb-0"),children:[e.jsxs("div",{className:f("h-10 flex items-center font-bold text-xl backdrop-blur-lg rounded-full","dark:bg-background dark:shadow-primary-100","bg-background !bg-opacity-50","shadow-sm shadow-primary-50","z-30 m-2 mb-0 sticky top-2 left-0"),children:[e.jsx("div",{className:f("mr-1 ease-in-out ml-0 md:relative z-50 md:z-auto",a&&"pl-2","md:!ml-0 md:pl-0"),children:e.jsx(g,{isIconOnly:!0,radius:"full",variant:"light",onPress:()=>s(!a),children:a?e.jsx(_,{size:24}):e.jsx(q,{size:24})})}),e.jsx(R,{isDisabled:!0,size:"lg",children:m==null?void 0:m.map((l,h)=>e.jsx(D,{children:e.jsx(k,{mode:"wait",children:e.jsx(p.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:10},transition:{duration:.3},children:l},l)})},h))})]}),e.jsx(J,{fallbackRender:Z,children:o})]})]})};function fe(){const o=w();return e.jsx(te,{children:e.jsx(c.Suspense,{fallback:e.jsx("div",{className:"flex justify-center px-10",children:e.jsx(L,{})}),children:e.jsx(k,{mode:"wait",children:e.jsx(p.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{type:"tween",ease:"easeInOut"},children:e.jsx(P,{})},o.pathname)})})})}export{fe as default};
