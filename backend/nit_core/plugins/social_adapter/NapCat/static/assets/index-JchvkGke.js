import{j as e,h}from"./codemirror-core-DIzFijqu.js";import{b as T,a as S,c as le}from"./chunk-5PILOUBS-BJiFHTkp.js";import{u as k,c as d,Z as L,_ as F,s as M,a0 as ce}from"./react-dom-BT-HHJs9.js";import{k as I,P as X,b as G,r as ie,W as y,M as oe,u as de}from"./index-tO5nu8Yv.js";import{t as Q}from"./chunk-6LIX6LVT-BOuIs8hJ.js";import{b as xe,Q as me}from"./qq_manager-5qPnyoE7.js";import{a as he,b as ue,c as pe,d as fe,e as ge}from"./index-COqcsWk-.js";import{i as J}from"./chunk-MLPFQTYO-lAEKjCEv.js";import{B as je}from"./index-3atF2w48.js";import{c as w}from"./chunk-NAV3ZXLI-HuApZD1r.js";import{t as be,a as K,s as ve,l as Ne}from"./chunk-KVDW62ZT-DlWCkB-8.js";import{s as we,u as ke}from"./use-config-BM2p375P.js";import{p as ye,B as ze}from"./index-BdWEI3Xi.js";import{i as Ce}from"./chunk-2QAN2V2R-CXqfx2Mo.js";import{F as Se,a as Me}from"./index-DhICtZLt.js";import{G as Y}from"./iconBase-ClXMXqAg.js";import{u as ee}from"./use-dialog-B1H9r95P.js";import"./chunk-WQVQ7P2I-bQ701xkJ.js";import"./chunk-M3MASYO7-BtOvSeRL.js";import"./index-CokAva9Y.js";import"./chunk-SLABUSGS-Kc2I43iC.js";import"./chunk-EN4B57RQ-2RHJdNk9.js";import"./chunk-OH2E76JR-CGA2UWeQ.js";const U=({count:s,label:a,size:r="md"})=>{const[t]=k(I.backgroundImage,""),l=!!t;return e.jsx(T,{className:d("backdrop-blur-sm border border-white/40 dark:border-white/10 shadow-sm transition-all",l?"bg-white/10 dark:bg-black/10 hover:bg-white/20 dark:hover:bg-black/20":"bg-white/60 dark:bg-black/40 hover:bg-white/70 dark:hover:bg-black/30",r==="md"?"col-span-8 md:col-span-2":"col-span-2 md:col-span-1"),shadow:"none",children:e.jsxs(S,{className:"items-center md:gap-1 p-1 md:p-2",children:[e.jsx("div",{className:d("flex-1 font-mono font-bold",r==="md"?"text-4xl md:text-5xl":"text-2xl md:text-3xl",l?"text-white drop-shadow-sm":"text-default-700 dark:text-gray-200"),children:s}),e.jsx("div",{className:d("whitespace-nowrap text-nowrap flex-shrink-0 font-medium",r==="md"?"text-sm":"text-xs",l?"text-white/80":"text-default-500"),children:a})]})})};function Le(){const{data:s,error:a,loading:r,run:t}=L(()=>ie.get("https://hitokoto.152710.xyz/"),{throttleWait:1e3}),l={hitokoto:"凡是过往，皆为序章。",from:"暴风雨",from_who:"莎士比亚"},n=(s==null?void 0:s.data)||(a?l:void 0),[c]=k(I.backgroundImage,""),o=!!c,m=()=>{try{const x=`${n==null?void 0:n.hitokoto} —— ${n==null?void 0:n.from} ${n==null?void 0:n.from_who}`;navigator.clipboard.writeText(x),F.success("复制成功")}catch{F.error("复制失败, 请手动复制")}};return e.jsxs("div",{className:"overflow-hidden",children:[e.jsxs("div",{className:"relative flex flex-col items-center justify-center p-4 md:p-6",children:[r&&!n&&e.jsx(X,{}),n&&e.jsxs(e.Fragment,{children:[e.jsx(xe,{className:d("text-4xl mb-4",o?"text-white/30":"text-primary/20")}),e.jsxs("div",{className:d("text-xl font-medium tracking-wide leading-relaxed italic",o?"text-white drop-shadow-sm":"text-default-700 dark:text-gray-200"),children:['" ',n==null?void 0:n.hitokoto,' "']}),e.jsxs("div",{className:"mt-4 flex flex-col items-center text-sm",children:[e.jsxs("span",{className:d("font-bold",o?"text-white/90":"text-primary-500/80"),children:["—— ",n==null?void 0:n.from]}),(n==null?void 0:n.from_who)&&e.jsxs("span",{className:d("text-xs mt-1",o?"text-white/70":"text-default-400"),children:["                ",n==null?void 0:n.from_who]})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Q,{content:"刷新",placement:"top",children:e.jsx(G,{className:d("transition-colors",o?"text-white/60 hover:text-white":"text-default-400 hover:text-primary"),onPress:t,size:"sm",isLoading:r,isIconOnly:!0,radius:"full",variant:"light",children:e.jsx(he,{})})}),e.jsx(Q,{content:"复制",placement:"top",children:e.jsx(G,{className:d("transition-colors",o?"text-white/60 hover:text-white":"text-default-400 hover:text-success"),onPress:m,size:"sm",isIconOnly:!0,radius:"full",variant:"light",children:e.jsx(ue,{})})})]})]})}const Ie=({data:s,error:a,loading:r})=>{const[t]=k(I.backgroundImage,""),l=!!t;return e.jsxs(T,{className:d("relative backdrop-blur-sm border border-white/40 dark:border-white/10 overflow-hidden flex-shrink-0 shadow-sm",l?"bg-white/10 dark:bg-black/10":"bg-white/60 dark:bg-black/40"),shadow:"none",radius:"lg",children:[e.jsx(X,{loading:r}),a?e.jsxs(S,{className:"items-center gap-1 justify-center",children:[e.jsx("div",{className:"flex-1 text-content1-foreground",children:"Error"}),e.jsx("div",{className:"whitespace-nowrap text-nowrap flex-shrink-0",children:a.message})]}):e.jsxs(S,{className:"flex-row items-center gap-4 overflow-hidden relative p-4",children:[!l&&e.jsx("div",{className:"absolute right-[-10px] bottom-[-10px] text-7xl text-default-400/10 rotate-12 pointer-events-none dark:hidden",children:e.jsx(je,{})}),e.jsxs("div",{className:"relative flex-shrink-0 z-10",children:[e.jsx(J,{src:(s==null?void 0:s.avatarUrl)??`https://q1.qlogo.cn/g?b=qq&nk=${s==null?void 0:s.uin}&s=0`,className:"shadow-sm rounded-full w-14 aspect-square ring-2 ring-white/50 dark:ring-white/10"}),e.jsx("div",{className:d("w-3.5 h-3.5 rounded-full absolute right-0.5 bottom-0.5 border-2 border-white dark:border-zinc-900 z-10",s!=null&&s.online?"bg-success-500":"bg-default-400")})]}),e.jsxs("div",{className:"flex-col justify-center z-10",children:[e.jsx("div",{className:d("text-xl font-bold truncate mb-0.5",l?"text-white drop-shadow-sm":"text-default-800 dark:text-gray-100"),children:(s==null?void 0:s.nick)||"未知用户"}),e.jsx("div",{className:d("font-mono text-xs tracking-wider",l?"text-white/80":"text-default-500 opacity-80"),children:(s==null?void 0:s.uin)||"Unknown"})]})]})]})};function qe(s){return Y({attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M14 18V20L16 21V22H8L7.99639 21.0036L10 20V18H2.9918C2.44405 18 2 17.5511 2 16.9925V4.00748C2 3.45107 2.45531 3 2.9918 3H21.0082C21.556 3 22 3.44892 22 4.00748V16.9925C22 17.5489 21.5447 18 21.0082 18H14ZM4 14V16H20V14H4Z"},child:[]}]})(s)}const _e=/^v?(0|[1-9]\d*)\.(0|[1-9]\d*)\.(0|[1-9]\d*)(?:-((?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\.(?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\+([0-9a-zA-Z-]+(?:\.[0-9a-zA-Z-]+)*))?$/,P=s=>{if(!s||typeof s!="string")return{valid:!1,normalized:"1.0.0-dev",major:1,minor:0,patch:0,prerelease:"dev",buildmetadata:null};const a=s.trim().match(_e);if(a){const r=parseInt(a[1],10),t=parseInt(a[2],10),l=parseInt(a[3],10),n=a[4]||null,c=a[5]||null;let o=`${r}.${t}.${l}`;return n&&(o+=`-${n}`),c&&(o+=`+${c}`),{valid:!0,normalized:o,major:r,minor:t,patch:l,prerelease:n,buildmetadata:c}}return{valid:!1,normalized:"1.0.0-dev",major:1,minor:0,patch:0,prerelease:"dev",buildmetadata:null}},se=(s,a)=>{const r=P(s),t=P(a);if(!r.valid||!t.valid)return 0;if(r.major!==t.major)return r.major>t.major?1:-1;if(r.minor!==t.minor)return r.minor>t.minor?1:-1;if(r.patch!==t.patch)return r.patch>t.patch?1:-1;if(r.prerelease&&!t.prerelease)return-1;if(!r.prerelease&&t.prerelease)return 1;if(r.prerelease&&t.prerelease){const l=r.prerelease.split("."),n=t.prerelease.split("."),c=Math.max(l.length,n.length);for(let o=0;o<c;o++){const m=l[o],x=n[o];if(m===void 0)return-1;if(x===void 0)return 1;const u=/^\d+$/.test(m)?parseInt(m,10):NaN,f=/^\d+$/.test(x)?parseInt(x,10):NaN;if(!isNaN(u)&&!isNaN(f)){if(u!==f)return u>f?1:-1;continue}if(!isNaN(u))return-1;if(!isNaN(f))return 1;if(m!==x)return m>x?1:-1}}return 0},Ve=(s,a)=>{const r=P(s),t=P(a);return!r.valid||!t.valid?!1:se(a,s)>0},H=({title:s,value:a="--",icon:r,endContent:t,hasBackground:l=!1,onClick:n,clickable:c=!1})=>e.jsxs("div",{className:d("flex text-sm gap-3 py-2 items-center transition-colors",l?"text-white/90":"text-default-600 dark:text-gray-300",c&&"cursor-pointer hover:bg-default-100/50 dark:hover:bg-default-800/30 rounded-lg -mx-2 px-2"),onClick:n,children:[e.jsx("div",{className:"text-lg opacity-70",children:r}),e.jsx("div",{className:"w-24 font-medium",children:s}),e.jsx("div",{className:d("text-xs font-mono flex-1",l?"text-white/80":"text-default-500"),children:a}),e.jsx("div",{children:t})]}),E=({currentVersion:s,latestVersion:a,status:r,errorMessage:t})=>e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-8 bg-default-50 dark:bg-default-100/5 rounded-xl border border-default-100 dark:border-default-100/10",children:[e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx("span",{className:"text-xs text-default-500 font-medium uppercase tracking-wider",children:"当前版本"}),e.jsxs(w,{size:"lg",variant:"flat",color:"default",classNames:{content:"font-mono font-bold text-lg"},children:["v",s]})]}),e.jsx("div",{className:"flex flex-col items-center text-primary-500 px-4",children:e.jsx("div",{className:"p-2 rounded-full bg-primary-50 dark:bg-primary-900/20",children:e.jsx("svg",{className:"w-6 h-6 animate-pulse",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 8l4 4m0 0l-4 4m4-4H3"})})})}),e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx("span",{className:"text-xs text-primary-500 font-medium uppercase tracking-wider",children:"最新版本"}),e.jsxs(w,{size:"lg",color:"primary",variant:"shadow",classNames:{content:"font-mono font-bold text-lg"},children:["v",a]})]})]}),r==="updating"&&e.jsxs("div",{className:"flex flex-col items-center justify-center gap-3 py-4 px-4 rounded-lg bg-primary-50/50 dark:bg-primary-900/20 border border-primary-200/50 dark:border-primary-700/30",children:[e.jsx(M,{size:"md",color:"primary"}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm font-medium text-primary-600 dark:text-primary-400",children:"正在更新中..."}),e.jsx("p",{className:"text-xs text-default-500 mt-1",children:"请耐心等待，更新可能需要几分钟"})]})]}),r==="success"&&e.jsxs("div",{className:"flex flex-col items-center justify-center gap-3 py-4 px-4 rounded-lg bg-success-50/50 dark:bg-success-900/20 border border-success-200/50 dark:border-success-700/30",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-success-100 dark:bg-success-900/40 flex items-center justify-center",children:e.jsx("svg",{className:"w-6 h-6 text-success-600 dark:text-success-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm font-medium text-success-600 dark:text-success-400",children:"更新完成"}),e.jsx("p",{className:"text-xs text-default-500 mt-1",children:"请重启 NapCat 以应用新版本"})]}),e.jsx("div",{className:"mt-2 p-3 rounded-lg bg-warning-50/50 dark:bg-warning-900/20 border border-warning-200/50 dark:border-warning-700/30",children:e.jsxs("p",{className:"text-xs text-warning-700 dark:text-warning-400 flex items-center gap-1",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),e.jsx("span",{children:"请手动重启 NapCat，更新才会生效"})]})})]}),r==="error"&&e.jsxs("div",{className:"flex flex-col items-center justify-center gap-3 py-4 px-4 rounded-lg bg-danger-50/50 dark:bg-danger-900/20 border border-danger-200/50 dark:border-danger-700/30",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-danger-100 dark:bg-danger-900/40 flex items-center justify-center",children:e.jsx("svg",{className:"w-6 h-6 text-danger-600 dark:text-danger-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm font-medium text-danger-600 dark:text-danger-400",children:"更新失败"}),e.jsx("p",{className:"text-xs text-default-500 mt-1",children:t||"请稍后重试或手动更新"})]})]})]}),Ue=s=>{const{currentVersion:a}=s,r=ee(),{data:t,error:l}=L(y.getLatestTag,{cacheKey:"napcat-latest-tag",staleTime:600*1e3,cacheTime:1800*1e3}),[n,c]=h.useState("idle");if(l||!t||!a||!Ve(a,t))return null;const o=async()=>{c("updating");try{await y.UpdateNapCat(),c("success"),r.alert({title:"更新完成",content:e.jsx(E,{currentVersion:a,latestVersion:t,status:"success"}),confirmText:"我知道了",size:"md"})}catch(x){console.error("Update failed:",x);const u=x instanceof Error?x.message:"未知错误";c("error"),r.alert({title:"更新失败",content:e.jsx(E,{currentVersion:a,latestVersion:t,status:"error",errorMessage:u}),confirmText:"确定",size:"md"})}},m=()=>{r.confirm({title:"发现新版本",content:e.jsx(E,{currentVersion:a,latestVersion:t,status:"idle"}),confirmText:"立即更新",cancelText:"稍后更新",size:"md",onConfirm:o})};return e.jsx(Q,{content:"有新版本可用",children:e.jsx("div",{className:"cursor-pointer",onClick:n==="updating"?void 0:m,children:e.jsx(w,{size:"sm",color:"danger",variant:"flat",classNames:{content:"font-bold text-[10px] px-1",base:"h-5 min-h-5"},children:n==="updating"?e.jsx(M,{size:"sm",color:"danger"}):"New"})})})},Qe=({currentVersion:s,onClose:a})=>{const r=ee(),[t,l]=h.useState(null),[n,c]=h.useState(!1),[o,m]=h.useState("idle"),[x,u]=h.useState(""),[f,j]=h.useState(1),[g,b]=h.useState("release"),[z,q]=h.useState(""),B=ce(z,300),$=15,{data:p,loading:te,error:D}=L(()=>y.getAllReleases({page:f,pageSize:$,type:g,search:B}),{refreshDeps:[f,g,B]}),A=(p==null?void 0:p.versions)||[],Z=h.useCallback(i=>!s||!i||i.startsWith("action-")?!1:se(i,s)<0,[s]),C=(t==null?void 0:t.tag)||"",_=Z(C),re=async()=>{if(t){if(_&&!n){r.confirm({title:"确认降级",content:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("p",{className:"text-warning-600",children:["您正在尝试从 ",e.jsxs("strong",{children:["v",s]})," 降级到 ",e.jsx("strong",{children:C})]}),e.jsx("p",{className:"text-sm text-default-500",children:"降级可能导致配置不兼容或功能丢失，请确认您了解相关风险。"})]}),confirmText:"确认降级",cancelText:"取消",onConfirm:()=>R(!0)});return}await R(n)}},R=async i=>{if(t){m("updating"),u("");try{await y.UpdateNapCatToVersion(C,i),m("success")}catch(v){console.error("Update failed:",v);const V=v instanceof Error?v.message:"未知错误";u(V),m("error")}}},ae=i=>{j(i)};if(o==="success")return e.jsxs("div",{className:"flex flex-col items-center justify-center gap-3 py-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-success-100 dark:bg-success-900/40 flex items-center justify-center",children:e.jsx("svg",{className:"w-6 h-6 text-success-600 dark:text-success-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),e.jsxs("div",{className:"text-center",children:[e.jsxs("p",{className:"text-sm font-medium text-success-600 dark:text-success-400",children:["更新到 ",C," 完成"]}),e.jsx("p",{className:"text-xs text-default-500 mt-1",children:"请重启 NapCat 以应用新版本"})]})]});if(o==="error")return e.jsxs("div",{className:"flex flex-col items-center justify-center gap-3 py-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-danger-100 dark:bg-danger-900/40 flex items-center justify-center",children:e.jsx("svg",{className:"w-6 h-6 text-danger-600 dark:text-danger-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm font-medium text-danger-600 dark:text-danger-400",children:"更新失败"}),e.jsx("p",{className:"text-xs text-default-500 mt-1",children:x||"请稍后重试"})]})]});if(o==="updating")return e.jsxs("div",{className:"flex flex-col items-center justify-center gap-3 py-6",children:[e.jsx(M,{size:"lg",color:"primary"}),e.jsxs("div",{className:"text-center",children:[e.jsxs("p",{className:"text-sm font-medium text-primary-600 dark:text-primary-400",children:["正在更新到 ",C,"..."]}),e.jsx("p",{className:"text-xs text-default-500 mt-1",children:"请耐心等待，更新可能需要几分钟"})]})]});const W=p==null?void 0:p.pagination;return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-default-600",children:"当前版本:"}),e.jsxs(w,{color:"primary",variant:"flat",size:"sm",children:["v",s]})]}),(p==null?void 0:p.mirror)&&e.jsxs("div",{className:"text-xs text-default-400 flex items-center gap-1",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-success-500"}),"镜像: ",p.mirror]})]}),e.jsxs(be,{selectedKey:g,onSelectionChange:i=>{b(i),j(1),l(null),q("")},size:"sm",color:"primary",variant:"underlined",classNames:{tabList:"gap-4"},children:[e.jsx(K,{title:"正式版本"},"release"),e.jsx(K,{title:"临时版本 (Action)"},"action")]}),e.jsx(Ce,{placeholder:"搜索版本号...",size:"sm",value:z,onValueChange:i=>{q(i),j(1),l(null)},startContent:e.jsx(ge,{className:"text-default-400"}),isClearable:!0,onClear:()=>q(""),classNames:{inputWrapper:"h-9"}}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{className:"text-sm font-medium text-default-700",children:"选择目标版本"}),(p==null?void 0:p.pagination)&&e.jsxs("span",{className:"text-xs text-default-400",children:["共 ",p.pagination.total," 个版本"]})]}),te?e.jsxs("div",{className:"flex items-center gap-2 py-2",children:[e.jsx(M,{size:"sm"}),e.jsx("span",{className:"text-sm text-default-500",children:"加载版本列表..."})]}):D?e.jsxs("div",{className:"text-sm text-danger-500",children:["加载版本列表失败: ",D.message]}):A.length===0?e.jsx("div",{className:"text-sm text-default-500 py-4 text-center",children:z?`未找到匹配 "${z}" 的版本`:"暂无可用版本"}):e.jsx(ve,{label:"选择版本",placeholder:"请选择要更新的版本",selectedKeys:t?[C]:[],onSelectionChange:i=>{const v=Array.from(i)[0],V=A.find(ne=>ne.tag===v);l(V||null)},classNames:{trigger:"h-auto min-h-10"},children:A.map(i=>{const v=i.tag.replace(/^v/,"")===s,V=Z(i.tag);return e.jsx(Ne,{textValue:i.tag,children:e.jsxs("div",{className:"flex flex-col gap-0.5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:i.type==="action"&&i.artifactName?i.artifactName:i.tag}),i.type==="prerelease"&&e.jsx(w,{size:"sm",color:"secondary",variant:"flat",children:"预发布"}),i.type==="action"&&e.jsx(w,{size:"sm",color:"default",variant:"flat",children:"临时"}),v&&e.jsx(w,{size:"sm",color:"success",variant:"flat",children:"当前"}),V&&!v&&i.type!=="action"&&e.jsx(w,{size:"sm",color:"warning",variant:"flat",children:"降级"})]}),i.type==="action"&&e.jsxs("div",{className:"text-xs text-default-400",children:[i.headSha&&e.jsx("span",{className:"font-mono",children:i.headSha.slice(0,7)}),i.createdAt&&e.jsx("span",{className:"ml-2",children:new Date(i.createdAt).toLocaleString()}),i.size&&e.jsxs("span",{className:"ml-2",children:[(i.size/1024/1024).toFixed(1)," MB"]})]})]})},i.tag)})})]}),g==="action"&&e.jsx("div",{className:"p-3 rounded-lg bg-default-50 dark:bg-default-100/10 border border-default-200/50",children:e.jsxs("p",{className:"text-xs text-default-500",children:["临时版本来自 GitHub Actions 构建，可能不稳定，适合测试新功能。",(t==null?void 0:t.expiresAt)&&e.jsxs("span",{className:"block mt-1 text-warning-600",children:["此版本将于 ",new Date(t.expiresAt).toLocaleDateString()," 过期"]})]})}),t&&_&&e.jsxs("div",{className:"p-3 rounded-lg bg-warning-50/50 dark:bg-warning-900/20 border border-warning-200/50 dark:border-warning-700/30",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("svg",{className:"w-5 h-5 text-warning-600 dark:text-warning-400 flex-shrink-0 mt-0.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-warning-700 dark:text-warning-400",children:"版本降级警告"}),e.jsx("p",{className:"text-xs text-warning-600/80 dark:text-warning-500 mt-1",children:"降级到旧版本可能导致配置不兼容或功能丢失"})]})]}),e.jsxs("div",{className:"mt-3 flex items-center gap-2",children:[e.jsx(we,{size:"sm",isSelected:n,onValueChange:c}),e.jsx("span",{className:"text-xs text-warning-700 dark:text-warning-400",children:"我了解风险，确认降级"})]})]}),W&&W.totalPages>1&&e.jsx("div",{className:"flex justify-center",children:e.jsx(ye,{total:W.totalPages,page:f,onChange:ae,size:"sm",showControls:!0})}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4 border-t border-default-100 dark:border-default-100/10",children:[e.jsx("button",{className:"px-4 py-2 text-sm rounded-lg bg-default-100 hover:bg-default-200 transition-colors",onClick:a,children:"关闭"}),e.jsx("button",{className:d("px-4 py-2 text-sm rounded-lg transition-colors text-white shadow-sm",t&&(!_||n)?"bg-primary-500 hover:bg-primary-600 shadow-primary-500/20":"bg-default-300 cursor-not-allowed"),disabled:!t||_&&!n,onClick:re,children:_?"确认降级更新":"更新到此版本"})]})]})},Te=({hasBackground:s=!1})=>{const[a,r]=h.useState(!1),{data:t,loading:l,error:n}=L(y.GetNapCatVersion,{cacheKey:"napcat-version",staleTime:3600*1e3,cacheTime:1440*60*1e3}),c=t==null?void 0:t.version,o=h.useCallback(()=>{c&&r(!0)},[c]);return e.jsxs(e.Fragment,{children:[e.jsx(H,{title:"NapCat 版本",icon:e.jsx(fe,{className:"text-xl"}),hasBackground:s,value:n?`错误：${n.message}`:l?e.jsx(M,{size:"sm"}):e.jsx(Q,{content:"点击管理版本",children:e.jsx("span",{className:"cursor-pointer hover:text-primary-500 transition-colors underline decoration-dashed underline-offset-2",onClick:o,children:c})}),endContent:e.jsx(Ue,{currentVersion:c})}),a&&e.jsx(oe,{title:"版本管理",size:"lg",hideFooter:!0,onClose:()=>r(!1),content:e.jsx(Qe,{currentVersion:c||"",onClose:()=>r(!1)})})]})},Be=s=>{const{archInfo:a}=s,{data:r,loading:t,error:l}=L(y.getQQVersion,{cacheKey:"qq-version",staleTime:3600*1e3,cacheTime:1440*60*1e3}),[n]=k(I.backgroundImage,""),c=!!n;return e.jsxs(T,{className:d("backdrop-blur-sm border border-white/40 dark:border-white/10 shadow-sm overflow-visible flex-1",c?"bg-white/10 dark:bg-black/10":"bg-white/60 dark:bg-black/40"),children:[e.jsxs(le,{className:d("pb-0 items-center gap-2 font-bold px-4 pt-4",c?"text-white drop-shadow-sm":"text-default-700 dark:text-white"),children:[e.jsx(Se,{className:"text-lg opacity-80"}),e.jsx("span",{children:"系统信息"})]}),e.jsx(S,{className:"flex-1",children:e.jsxs("div",{className:"flex flex-col gap-2 justify-between h-full",children:[e.jsx(Te,{hasBackground:c}),e.jsx(H,{title:"QQ 版本",icon:e.jsx(Me,{className:"text-lg"}),hasBackground:c,value:l?`错误：${l.message}`:t?e.jsx(M,{size:"sm"}):r}),e.jsx(H,{title:"WebUI 版本",icon:e.jsx(pe,{className:"text-xl"}),value:"Next",hasBackground:c}),e.jsx(H,{title:"系统版本",icon:e.jsx(qe,{className:"text-xl"}),value:a,hasBackground:c})]})})]})};function He(s){return Y({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M151 22v32h18V22h-18zm48 0v32h18V22h-18zm48 0v32h18V22h-18zm48 0v32h18V22h-18zm48 0v32h18V22h-18zM131.7 73L73 131.7v248.6l58.7 58.7h248.6l58.7-58.7V131.7L380.3 73H131.7zm60.3 46h128v18H192v-18zM22 151v18h32v-18H22zm436 0v18h32v-18h-32zm-339 32h274v146H119V183zm-97 16v18h32v-18H22zm436 0v18h32v-18h-32zm-321 2v110h238V201H137zM22 247v18h32v-18H22zm436 0v18h32v-18h-32zM22 295v18h32v-18H22zm436 0v18h32v-18h-32zM22 343v18h32v-18H22zm436 0v18h32v-18h-32zm-266 32h128v18H192v-18zm-41 83v32h18v-32h-18zm48 0v32h18v-32h-18zm48 0v32h18v-32h-18zm48 0v32h18v-32h-18zm48 0v32h18v-32h-18z"},child:[]}]})(s)}const Pe="/webui/assets/1AD934174C0107F14BAD8776D29C5F90-AKhWf6dl.png",O=({systemUsage:s,processUsage:a,title:r,hasBackground:t})=>{const{theme:l}=de(),n=Math.max(s||0,0),c=Math.max(a||0,0),o=Math.min(Math.max(n,c),100),m=Math.min(c,o),x=100,u=10,f=(x-u)/2,j=2*Math.PI*f,g=x/2,b={qq:"#D33FF0",other:l==="dark"?"#EF8664":"#EA7D9B",track:l==="dark"?"rgba(255,255,255,0.08)":"rgba(0,0,0,0.05)"},z=h.useMemo(()=>`${o/100*j} ${j}`,[o,j]),q=h.useMemo(()=>`${m/100*j} ${j}`,[m,j]),B=Math.max(o-m,0),$=e.jsxs("div",{className:"flex flex-col gap-1 p-1 text-xs",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-2 h-2 rounded-full",style:{backgroundColor:b.qq}}),e.jsxs("span",{children:["QQ进程: ",m.toFixed(1),"%"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-2 h-2 rounded-full",style:{backgroundColor:b.other}}),e.jsxs("span",{children:["其他进程: ",B.toFixed(1),"%"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-2 h-2 rounded-full",style:{backgroundColor:b.track}}),e.jsxs("span",{children:["空闲: ",(100-o).toFixed(1),"%"]})]})]});return e.jsx(Q,{content:$,placement:"top",children:e.jsxs("div",{className:"relative w-36 h-36 flex items-center justify-center cursor-pointer",children:[e.jsxs("svg",{className:"w-full h-full -rotate-90",viewBox:`0 0 ${x} ${x}`,children:[e.jsx("circle",{cx:g,cy:g,r:f,fill:"none",stroke:b.track,strokeWidth:u,strokeLinecap:"round"}),e.jsx("circle",{cx:g,cy:g,r:f,fill:"none",stroke:b.other,strokeWidth:u,strokeLinecap:"round",strokeDasharray:z,className:"transition-all duration-700 ease-out"}),e.jsx("circle",{cx:g,cy:g,r:f,fill:"none",stroke:b.qq,strokeWidth:u,strokeLinecap:"round",strokeDasharray:q,className:"transition-all duration-700 ease-out"})]}),e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center pointer-events-none select-none",children:[r&&e.jsx("span",{className:d("text-[10px] font-medium mb-0.5 opacity-80 uppercase tracking-widest scale-90",t?"text-white/80":"text-default-500 dark:text-default-400"),children:r}),e.jsxs("div",{className:"flex items-baseline gap-0.5",children:[e.jsx("span",{className:d("text-2xl font-bold font-mono tracking-tight",t?"text-white":"text-default-900 dark:text-white"),children:Math.round(o)}),e.jsx("span",{className:d("text-xs font-bold",t?"text-white/60":"text-default-400 dark:text-default-500"),children:"%"})]})]})]})})},N=({title:s,value:a="-",size:r="md",unit:t,hasBackground:l=!1})=>e.jsxs("div",{className:d("py-1.5 text-sm transition-colors",r==="lg"?"col-span-2":"col-span-1 flex justify-between"),children:[e.jsx("div",{className:d("w-24 font-medium",l?"text-white/90":"text-default-600 dark:text-gray-300"),children:s}),e.jsxs("div",{className:d("font-mono text-xs",l?"text-white/80":"text-default-500"),children:[a,t&&e.jsx("span",{className:"ml-0.5 opacity-70",children:t})]})]}),$e=({data:s})=>{const a={system:0,qq:0};if(s){const l=Number(s.memory.total)||1,n=Number(s.memory.usage.system),c=Number(s.memory.usage.qq);a.system=n/l*100,a.qq=c/l*100}const[r]=k(I.backgroundImage,""),t=!!r;return e.jsxs(T,{className:d("backdrop-blur-sm border border-white/40 dark:border-white/10 shadow-sm col-span-1 lg:col-span-2 relative overflow-hidden",t?"bg-white/10 dark:bg-black/10":"bg-white/60 dark:bg-black/40"),children:[e.jsx("div",{className:"absolute h-full right-0 top-0",children:e.jsx(J,{src:Pe,alt:"background",className:"select-none pointer-events-none !opacity-30 w-full h-full",classNames:{wrapper:"w-full h-full",img:"object-contain w-full h-full"}})}),e.jsxs(S,{className:"overflow-visible md:flex-row gap-4 items-center justify-stretch z-10",children:[e.jsxs("div",{className:"flex-1 w-full md:max-w-96",children:[e.jsxs("h2",{className:d("text-lg font-semibold flex items-center gap-2 mb-2",t?"text-white drop-shadow-sm":"text-default-700 dark:text-gray-200"),children:[e.jsx(He,{className:"text-xl opacity-80"}),e.jsx("span",{children:"CPU"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx(N,{title:"型号",value:s==null?void 0:s.cpu.model,size:"lg",hasBackground:t}),e.jsx(N,{title:"内核数",value:s==null?void 0:s.cpu.core,hasBackground:t}),e.jsx(N,{title:"主频",value:s==null?void 0:s.cpu.speed,unit:"GHz",hasBackground:t}),e.jsx(N,{title:"使用率",value:s==null?void 0:s.cpu.usage.system,unit:"%",hasBackground:t}),e.jsx(N,{title:"QQ主线程",value:s==null?void 0:s.cpu.usage.qq,unit:"%",hasBackground:t})]}),e.jsxs("h2",{className:d("text-lg font-semibold flex items-center gap-2 mb-2 mt-4",t?"text-white drop-shadow-sm":"text-default-700 dark:text-gray-200"),children:[e.jsx(ze,{className:"text-xl opacity-80"}),e.jsx("span",{children:"内存"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx(N,{title:"总量",value:s==null?void 0:s.memory.total,size:"lg",unit:"MB",hasBackground:t}),e.jsx(N,{title:"使用量",value:s==null?void 0:s.memory.usage.system,unit:"MB",hasBackground:t}),e.jsx(N,{title:"QQ主线程",value:s==null?void 0:s.memory.usage.qq,unit:"MB",hasBackground:t})]})]}),e.jsxs("div",{className:"flex flex-row md:flex-col gap-2 flex-shrink-0 w-full justify-center md:w-40 min-h-40 mt-4 md:mt-0 md:mx-auto",children:[e.jsx(O,{systemUsage:Number(s==null?void 0:s.cpu.usage.system)||0,processUsage:Number(s==null?void 0:s.cpu.usage.qq)||0,title:"CPU占用",hasBackground:t}),e.jsx(O,{systemUsage:a.system,processUsage:a.qq,title:"内存占用",hasBackground:t})]})]})]})},Ae=()=>{const{config:s,refreshConfig:a}=ke(),r=s.network.httpClients.length+s.network.websocketClients.length+s.network.websocketServers.length+s.network.httpServers.length;return h.useEffect(()=>{a()},[]),e.jsxs("div",{className:"grid grid-cols-8 md:grid-cols-3 lg:grid-cols-6 gap-y-2 gap-x-1 md:gap-y-4 md:gap-x-4 py-5",children:[e.jsx(U,{count:r,label:"网络配置"}),e.jsx(U,{count:s.network.httpServers.length,label:"HTTP服务器",size:"sm"}),e.jsx(U,{count:s.network.httpClients.length,label:"HTTP客户端",size:"sm"}),e.jsx(U,{count:s.network.websocketServers.length,label:"WS服务器",size:"sm"}),e.jsx(U,{count:s.network.websocketClients.length,label:"WS客户端",size:"sm"})]})},We=()=>{const{data:s,loading:a,error:r}=L(me.getQQLoginInfo);return e.jsx(Ie,{data:s,error:r,loading:a})},Ee=({setArchInfo:s})=>{const[a,r]=k("napcat_system_status_cache",void 0),t=h.useRef(!1),l=h.useCallback(()=>{try{return y.getSystemStatus(r)}catch{F.error("获取系统状态失败")}},[]);return h.useEffect(()=>{const n=l();return()=>{n==null||n.close()}},[l]),h.useEffect(()=>{a!=null&&a.arch&&!t.current&&(s(a.arch),t.current=!0)},[a,s]),e.jsx($e,{data:a})},hs=()=>{const[s,a]=k("napcat_arch_info_cache",void 0),[r]=k(I.backgroundImage,""),t=!!r;return e.jsxs(e.Fragment,{children:[e.jsx("title",{children:"基础信息 - NapCat WebUI"}),e.jsxs("section",{className:"w-full p-2 md:p-4 md:max-w-[1000px] mx-auto overflow-hidden",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4 items-stretch",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(We,{}),e.jsx(Be,{archInfo:s})]}),e.jsx(Ee,{setArchInfo:a})]}),e.jsx(Ae,{}),e.jsx(T,{className:d("backdrop-blur-sm border border-white/40 dark:border-white/10 shadow-sm transition-all overflow-hidden",t?"bg-white/10 dark:bg-black/10":"bg-white/60 dark:bg-black/40"),children:e.jsx(S,{className:"overflow-hidden",children:e.jsx(Le,{})})})]})]})};export{hs as default};
